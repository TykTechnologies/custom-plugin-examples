name: Build assets

on:
  workflow_dispatch:
    inputs:
      version:
        default: 'v3.1.0'
        description: 'Build Go Plugins'
        required: true
#   push:
#     paths:
#       - 'graphql/schema.graphql'
#     branches:
#       - 'as/manual-bindata'

env:
#   SLACK_CLI_TOKEN: ${{ secrets.BENDER_TOKEN }}
  VERSION: ${{ github.event.client_payload.sha || github.event.inputs.version }}

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - name: checkout custom-plugins/master
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.client_payload.ref }}
          
      - name: Build plugins
        working-directory: ./plugins/go-auth-basicauth_dynamodb
        run: |
          docker run --rm -v `pwd`:/plugin-source tykio/tyk-plugin-compiler:${{ VERSION }} go-auth-basicauth_dynamodb_${{ VERSION }}.so
          git status
          
#       - name: Commit bindata and submodule
#         run: |
#           git config --local user.email "tip@tyk-analytics-ui"
#           git config --local user.name "Bender"
#           git add dashboard/bindata.go webclient
#           git add -f .assets_vendor
#           git commit -m "[CI] Adding assets from tyk-analytics-ui/${{ github.event.client_payload.ref }}/${{ github.event.client_payload.sha }}"
          
#       - name: Push changes
#         id: push
#         run: |
#           git pull --no-edit --ff --strategy=ours --commit --recurse-submodules=off origin ${{ env.TA_REF }}
#           git remote set-url origin "$(git config --get remote.origin.url | sed 's#http.*com/#git@github.com:#g')"
#           git push -v origin ${{ env.TA_REF }}

